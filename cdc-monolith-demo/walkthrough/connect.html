<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Demo Walkthrough :: CDC Monolith Demo</title>
    <link rel="canonical" href="https://hatmarch.github.io/cdc-data-monolith/cdc-monolith-demo/walkthrough/connect.html">
    <link rel="prev" href="strimzi.html#strimzi">
    <link rel="next" href="legacy-cdc.html#cdc">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://hatmarch.github.io/cdc-data-monolith">CDC Monolith Demo</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cdc-monolith-demo" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">CDC Monolith Demo</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01-setup.html">General Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#install">Install Demo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01-setup.html#uninstall">Uninstalling Demo</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html#setup">Demo Walkthrough</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="legacy.html#legacy">Intro to Legacy App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="producer-consumer.html#producerconsumer">Kafka: Producers, Consumers, and Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="strimzi.html#strimzi">Strimzi and AMQStreams Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#examplekafkaconnect">Kafka Connect Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="legacy-cdc.html#cdc">Legacy App Change Data Capture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="consumer-adaptor.html#deploylegacyconsumer">Deploy Legacy Consumer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-appendix">Appendix</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#querysql">Querying SQL Database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#kafkatopicdebug">Debugging Kafka Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#mssql">Connect and View MS SQL Database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#build">Build Legacy Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#deploy">Deploy Legacy Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#testapp">Strategies for Testing Legacy Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#buildcoolstore">Building Coolstore Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03-appendix.html#legacyinteract">Interacting with Legacy App</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#04-troubleshooting">Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting.html#kafka">Troubleshooting Kafka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04-troubleshooting.html#kafkaconnect">Troubleshooting Kafka Connect</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">CDC Monolith Demo</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">CDC Monolith Demo</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">CDC Monolith Demo</a></li>
    <li><a href="index.html#setup">Demo Walkthrough</a></li>
    <li><a href="#examplekafkaconnect">Kafka Connect Introduction</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///workspaces/cdc-data-monolith/documentation/modules/ROOT/pages/walkthrough/connect.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Demo Walkthrough</h1>
<div class="sect1">
<h2 id="examplekafkaconnect"><a class="anchor" href="#examplekafkaconnect"></a>Kafka Connect Introduction</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section assumes you have setup a kafka cluster in <code>cdc-sandbox</code> already.  If you have not, then please first complete <a href="strimzi.html#strimzi" class="page">this part of the walkthrough</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <code>cdc-sandbox</code> project, Developer Perspective</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>example</code> kafka cluster should be fully running now
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Before doing anything, pick a shell and run the following <code>stern</code> command which we&#8217;ll use to look at the plugins on the Connect instance</p>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_terminal-1"></a>Terminal 1</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_terminal-1">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stern connect -n cdc-sandbox -i "Added plugin"</code></pre>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Click the book with the plus (<code>Quick Catalog Add</code>) and type <code>Connect</code> in the text box and then click <code>Create</code></p>
<div class="paragraph">
<p><span class="image"><img src="../_images/kafka-connect-catalog.png" alt="kafka connect catalog"></span></p>
</div>
</li>
<li>
<p>Then fill in the kafka connect form view per below <strong>being extra careful to remove the tls certs</strong> and <strong>*add the annotation</strong> in YAML</p>
<div class="paragraph">
<p><span class="image"><img src="../_images/kafka-connect-form.png" alt="kafka connect form"></span>
<span class="image"><img src="../_images/remove-certs.png" alt="remove certs"></span></p>
</div>
</li>
<li>
<p>Switch to YAML view and make sure to add the following annotation:</p>
<div class="listingblock">
<div class="content">
<pre>  annotations:
    strimzi.io/use-connector-resources: 'true'</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/kafka-connect-yaml.png" alt="kafka connect yaml">
</div>
</div>
</li>
<li>
<p>Finally click <code>Create</code> to create the KakfaConnect</p>
</li>
<li>
<p>After a few moments you should see the following in the <code>stern</code> shell (<strong>Terminal 1</strong>)</p>
<div class="listingblock console-output">
<div class="content">
<pre>+ example-connect-7856c88cf-mthmb › example-connect
example-connect-7856c88cf-mthmb example-connect 2021-03-10 12:05:05,423 INFO Added plugin 'org.apache.kafka.connect.mirror.MirrorSourceConnector' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]
example-connect-7856c88cf-mthmb example-connect 2021-03-10 12:05:05,423 INFO Added plugin 'org.apache.kafka.connect.file.FileStreamSinkConnector' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]
example-connect-7856c88cf-mthmb example-connect 2021-03-10 12:05:05,424 INFO Added plugin 'org.apache.kafka.connect.tools.MockSourceConnector' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]
example-connect-7856c88cf-mthmb example-connect 2021-03-10 12:05:05,424 INFO Added plugin 'org.apache.kafka.connect.tools.SchemaSourceConnector' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]
#example-connect-7856c88cf-mthmb example-connect 2021-03-10 12:05:05,424 INFO Added plugin 'org.apache.kafka.connect.file.FileStreamSourceConnector' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]#
...
NoneConnectorClientConfigOverridePolicy' (org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) [main]</pre>
</div>
</div>
</li>
<li>
<p>Then, make the following two terminals visible and run the commands therein:</p>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_terminal2"></a>Terminal2</p>
</li>
<li>
<p><a id="tabset2_terminal-3"></a>Terminal 3</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_terminal2">
<div class="paragraph">
<p>Here we will remote to the connect instance</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc rsh -n cdc-sandbox deploy/example-connect</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once connected, run the following in the pod:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /tmp
echo "Line 1" &gt;&gt; test.txt</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_terminal-3">
<div class="paragraph">
<p>Here we will look to receive any updates on the topic that the file will be streaming to</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -it example-kafka-0 -n cdc-sandbox -- bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic file-stream-topic --from-beginning</code></pre>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Next, use the <code>Quick Add Catalog</code> button to create a new <code>Kafka Connector</code></p>
<div class="paragraph">
<p><span class="image"><img src="../_images/new-kafka-connector.png" alt="new kafka connector"></span></p>
</div>
</li>
<li>
<p>Switch to <code>YAML View</code></p>
</li>
<li>
<p>Show that the name of the connector matches the Plugin log output from Terminal 1</p>
<div class="ulist">
<ul>
<li>
<p><code>org.apache.kafka.connect.file.FileStreamSourceConnector</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Update the YAML as follows:</p>
<div class="ulist">
<ul>
<li>
<p>Make sure the topic matches what is being consumed in <strong>Terminal 3</strong></p>
</li>
<li>
<p>Make sure the file matches what was just created in the <code>rsh</code> on <strong>Terminal 2</strong></p>
<div class="imageblock">
<div class="content">
<img src="../_images/file-connector-yaml.png" alt="file connector yaml">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>A few moments later, you should then see the following in <strong>Terminal 3</strong></p>
<div class="listingblock console-output">
<div class="content">
<pre>{"schema":{"type":"string","optional":false},"payload":"Line 1"}</pre>
</div>
</div>
</li>
<li>
<p>Click <code>Search</code> and then start typing <code>kafkaconnnect</code> and select <code>KafkaConnector</code> from the drop-down</p>
<div class="paragraph">
<p><span class="image"><img src="../_images/connector-search.png" alt="connector search"></span></p>
</div>
</li>
<li>
<p>Click on the <code>file-stream-connector</code> and then the YAML view</p>
<div class="imageblock">
<div class="content">
<img src="../_images/connector-status.png" alt="connector status">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively, you can following command in Terminal 2 (rsh)</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8083/connectors/file-stream-connector/status</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Next let&#8217;s pump some text through the file</p>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_terminal-2-rsh"></a>Terminal 2 (rsh)</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_terminal-2-rsh">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">c=1; while (true); do ((c=c+1)); echo "Line ${c}" &gt;&gt; test.txt; sleep 2; done</code></pre>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>This should cause lines like the following to appear every 2 seconds in <strong>Terminal 3</strong></p>
<div class="listingblock console-output">
<div class="content">
<pre>{"schema":{"type":"string","optional":false},"payload":"Line 2"}
{"schema":{"type":"string","optional":false},"payload":"Line 3"}
{"schema":{"type":"string","optional":false},"payload":"Line 4"}
{"schema":{"type":"string","optional":false},"payload":"Line 5"}
{"schema":{"type":"string","optional":false},"payload":"Line 6"}
{"schema":{"type":"string","optional":false},"payload":"Line 7"}
{"schema":{"type":"string","optional":false},"payload":"Line 8"}
{"schema":{"type":"string","optional":false},"payload":"Line 9"}
{"schema":{"type":"string","optional":false},"payload":"Line 10"}</pre>
</div>
</div>
</li>
<li>
<p>Delete the kafkaconnector and then notice that eventually (when the amq operator catches up) the topic goes silent</p>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_terminal-1"></a>Terminal 1</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_terminal-1">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete -n cdc-sandbox kafkaconnector/file-stream-connector</code></pre>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Finally, you might consider returning to <strong>Terminal 2</strong> to show that the writing to the file continued</p>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_terminal-2-rsh"></a>Terminal 2 (rsh)</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_terminal-2-rsh">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat test.txt</code></pre>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>This should yield output something like this:</p>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Line 1
Line 2
Line 3
Line 4
Line 5
Line 6
Line 7
Line 8
Line 9
Line 10
Line 11
Line 12
Line 13
Line 14
Line 15
Line 16
Line 17
Line 18
Line 19
Line 20</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="strimzi.html#strimzi" class="query-params-link">Strimzi and AMQStreams Operator</a></span>
  <span class="next"><a href="legacy-cdc.html#cdc" class="query-params-link">Legacy App Change Data Capture</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
