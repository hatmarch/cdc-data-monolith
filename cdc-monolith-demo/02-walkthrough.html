<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Demo Walkthrough :: CDC Monolith Demo (Dev Mode)</title>
    <link rel="canonical" href="https://hatmarch.github.io/cdc-data-monolith/cdc-monolith-demo/02-walkthrough.html">
    <link rel="prev" href="01-setup.html">
    <link rel="next" href="03-appendix.html#querysql">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://hatmarch.github.io/cdc-data-monolith">CDC Monolith Demo (Dev Mode)</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cdc-monolith-demo" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">CDC Monolith Demo</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#install">Install Demo</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-walkthrough.html">2. Walkthrough</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#legacy">Intro to Legacy App</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#03-appendix">Appendix</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-appendix.html#querysql">Querying SQL Database</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-appendix.html#kafkatopicdebug">Debugging Kafka Topics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">CDC Monolith Demo</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">CDC Monolith Demo</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">CDC Monolith Demo</a></li>
    <li><a href="02-walkthrough.html">2. Walkthrough</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/hatmarch/cdc-data-monolith/edit/master/documentation/modules/ROOT/pages/02-walkthrough.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Demo Walkthrough</h1>
<div class="sect1">
<h2 id="legacy"><a class="anchor" href="#legacy"></a>Introduction to Legacy Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can get the URL to the legacy application by running the following command in the demo shell</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LEGACY_URL=http://$(oc get route www -o jsonpath='{.spec.host}' -n ${PROJECT_PREFIX}-dev)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demonstrate_dual_write"><a class="anchor" href="#_demonstrate_dual_write"></a>Demonstrate Dual Write</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Post a file to legacy app:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST -H 'Content-Type: multipart/form-data' --compressed --insecure -F fileToUpload=@earth-orders.csv -F submit="true" -F fragment="_user10" $LEGACY_URL/upload.php</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can see the code of the upload.php page <a href="https://github.com/RedHat-Middleware-Workshops/dayinthelife-streaming/blob/ca810c56c9017424e128768c93983a3b4b8ca1b5/support/projects/module-2/enterprise-app/upload.php">here</a> to understand more about how it consumes the posted data</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enable_debezium_connector"><a class="anchor" href="#_enable_debezium_connector"></a>Enable Debezium Connector</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configure_sql_database"><a class="anchor" href="#_configure_sql_database"></a>Configure SQL Database</h3>
<div class="paragraph">
<p>See last part of <code>ansible/demo/templates/configmap-data-sql.yaml.j2</code> and instructions <a href="https://debezium.io/documentation/reference/connectors/sqlserver.html#_enabling_cdc_on_the_sql_server_database">here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_create_connect"><a class="anchor" href="#_create_connect"></a>Create Connect</h3>
<div class="paragraph">
<p>See: <code>ansible/demo/templates/kafka-connect.yaml.j2</code></p>
</div>
<div class="paragraph">
<p>This is for metadata about the connector (I think)</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_connector"><a class="anchor" href="#_create_connector"></a>Create Connector</h3>
<div class="paragraph">
<p>See: <code>ansible/demo/templates/kafka-connector-mssql.yaml.j2</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="demonstratedbz"><a class="anchor" href="#demonstratedbz"></a>Demonstrate Debezium</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to database using Adminer per instructions <a href="03-appendix.html#mssql" class="page">here</a></p>
</li>
<li>
<p>In another terminal watch where the order events will go</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -it demo-kafka-0 -- bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic mssql-server-linux.dbo.Orders --from-beginning</code></pre>
</div>
</div>
</li>
<li>
<p>Go to adminer and create a new entry</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generate_legacy_order_adaptor"><a class="anchor" href="#_generate_legacy_order_adaptor"></a>Generate legacy-order-adaptor</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_function"><a class="anchor" href="#_create_function"></a>Create function</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use the following command to create a function scaffolding</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kn func create -t events -l quarkus legacy-order-adaptor</code></pre>
</div>
</div>
</li>
<li>
<p>update <code>func.yml</code> with proper image target <code>quay.io/mhildenb/legacy-order-adaptor</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_json_to_pojo"><a class="anchor" href="#_create_json_to_pojo"></a>Create JSON to POJO</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start with some example <code>.json</code> generated from CDC event in <a href="#demonstratedbz">this section</a></p>
</li>
<li>
<p>Navigate to <a href="http://www.jsonschema2pojo.org/">this site</a> and paste in the json per screenshot</p>
<div class="imageblock">
<div class="content">
<img src="_images/json2pojo.png" alt="json2pojo">
</div>
</div>
</li>
<li>
<p>Click the link to download the zip file</p>
</li>
<li>
<p>expand into the <code>functions</code> directory</p>
</li>
<li>
<p>Update tests to show JSON to POJO working</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-setup.html" class="query-params-link">1. Setup</a></span>
  <span class="next"><a href="03-appendix.html#querysql" class="query-params-link">Querying SQL Database</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
